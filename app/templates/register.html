{% extends "base.html" %}
{% block title %}Register - Invoicing App{% endblock %}

{% block content %}
<div class="max-w-md mx-auto bg-white shadow rounded p-6">
  <h1 class="text-xl font-semibold mb-4">Register</h1>
  <form id="registerForm" class="space-y-4">
    <div>
      <label class="block text-sm font-medium mb-1">Username</label>
      <input type="text" name="username" class="w-full border rounded px-3 py-2 text-sm" required>
    </div>
    <div>
      <label class="block text-sm font-medium mb-1">Password</label>
      <input type="password" name="password" class="w-full border rounded px-3 py-2 text-sm" required>
    </div>
    <p id="registerError" class="text-sm text-red-600 hidden"></p>
    <button type="submit" class="w-full bg-green-600 text-white rounded py-2 text-sm font-medium hover:bg-green-700">
      Register
    </button>
    <p class="mt-3 text-xs text-gray-600">
      Already have an account?
      <a href="/login" class="text-blue-600 hover:underline">Login</a>
    </p>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.getElementById('registerForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target;
    const errorEl = document.getElementById('registerError');
    errorEl.classList.add('hidden');

    const payload = {
      username: form.username.value.trim(),
      password: form.password.value.trim()
    };

    try {
      const res = await fetch('/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      const data = await res.json();

      if (!res.ok) {
        errorEl.textContent = data.error || 'Registration failed';
        errorEl.classList.remove('hidden');
        return;
      }

      // auto-login after register
      window.location.href = '/login';
    } catch (err) {
      console.error(err);
      errorEl.textContent = 'Network error';
      errorEl.classList.remove('hidden');
    }
  });
</script>
{% endblock %}
